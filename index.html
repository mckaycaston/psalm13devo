<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A Shield for the Overwhelmed | An Interactive Devotional on Psalm 3</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,300;0,400;0,700;1,300;1,400&family=Source+Sans+3:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutrals -->
    <!-- Application Structure Plan: The SPA is designed around a central, tab-based interactive framework rather than a simple linear scroll. The main navigation separates the devotional into thematic sections: 'Home', 'Scripture', 'Core Concepts', and 'Prayer'. The Core Concepts section uses interactive tabs for 'Principle', 'Problem', 'Gospel', and 'Response'. This structure was chosen to reduce cognitive load and encourage non-linear exploration. New interactive textareas are added in the intro and each core concept to gather user reflections. This data is then synthesized in the 'Prayer' section by the Gemini API into a final, personalized prayer, creating a guided journey from understanding to personal application. -->
    <!-- Visualization & Content Choices: Report Info: The devotional's content is theological and reflective. Goal: To make abstract concepts tangible and personal. Viz/Presentation Method: Interactive textareas for user input are now central. Interaction: Users write their own reflections which are stored in a JS object. A final button press sends this compiled object to the Gemini API. Justification: This transforms the app from a content delivery system into a personal journaling and prayer generation tool, dramatically increasing engagement and personal value. The original 'Illustrate with Story' and 'Quick Prayer' Gemini features are retained to provide multiple avenues for interaction. CONFIRMING NO SVG/Mermaid. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <!-- Copyright (c) 2025 McKay Caston. All Rights Reserved. -->
    <style>
        body {
            font-family: 'Source Sans 3', sans-serif;
            background-color: #FDFBF8; /* Warm Off-White */
            color: #4B423A; /* Dark Brown */
        }
        h1, h2, h3, h4 {
            font-family: 'Merriweather', serif;
        }
        .nav-link {
            transition: color 0.3s, border-color 0.3s;
        }
        .nav-link.active {
            color: #D3A578; /* Muted Gold */
            border-bottom-color: #D3A578;
        }
        .concept-tab.active {
            background-color: #D3A578; /* Muted Gold */
            color: #FDFBF8;
        }
        .highlight-verse {
            background-color: #F3E9DE; /* Light Beige */
            border-radius: 4px;
            padding: 2px 4px;
            transition: background-color 0.5s ease;
        }
        .content-panel {
            display: none;
        }
        .content-panel.active {
            display: block;
        }
    </style>
</head>
<body class="antialiased">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-[#6D5D4D]">A Shield for the Overwhelmed</h1>
            <p class="text-lg text-[#8A7968] mt-2">An Interactive Devotional on Psalm 3</p>
        </header>

        <nav class="flex justify-center border-b border-[#EAE0D5] mb-8">
            <a href="#" id="nav-home" class="nav-link text-lg font-semibold py-4 px-6 border-b-2 border-transparent hover:text-[#D3A578]">Home</a>
            <a href="#" id="nav-scripture" class="nav-link text-lg font-semibold py-4 px-6 border-b-2 border-transparent hover:text-[#D3A578]">Scripture</a>
            <a href="#" id="nav-core-concepts" class="nav-link text-lg font-semibold py-4 px-6 border-b-2 border-transparent hover:text-[#D3A578]">Core Concepts</a>
            <a href="#" id="nav-prayer" class="nav-link text-lg font-semibold py-4 px-6 border-b-2 border-transparent hover:text-[#D3A578]">Prayer</a>
        </nav>

        <main id="main-content">
            
            <section id="home-content" class="content-panel active">
                <div class="max-w-3xl mx-auto bg-white/50 p-8 rounded-lg shadow-sm border border-[#EAE0D5]">
                    <h2 class="text-3xl font-bold mb-4 text-[#6D5D4D]">Introduction</h2>
                    <p class="text-lg leading-relaxed mb-4">Have you ever felt completely surrounded? The pressures of work, the strain in a relationship, the anxieties of your own heart, the sheer number of things going wrong—it can feel like an army is rising against you. In those moments, a taunting voice often whispers, "You're all alone. God has forgotten you."</p>
                    <p class="text-lg leading-relaxed">King David knew this feeling intimately. The heading of Psalm 3 tells us the exact context: he is on the run, fleeing from his own son, Absalom. Betrayed, outnumbered, and publicly shamed, David pens this psalm. It’s a raw cry from a desperate situation, but it’s also a powerful blueprint for finding peace. This interactive devotional is designed to help you explore that blueprint.</p>
                     <div class="mt-8 pt-8 border-t border-[#EAE0D5]">
                        <h3 class="text-2xl font-bold mb-4 text-[#6D5D4D]">Connect with the Psalm</h3>
                        <p class="text-lg text-[#8A7968] mb-4">How does this feeling of being overwhelmed resonate with you right now? Briefly jot down your thoughts.</p>
                        <textarea id="intro-input" class="personalization-input w-full p-3 border border-[#EAE0D5] rounded-md focus:ring-2 focus:ring-[#D3A578] focus:outline-none transition duration-200 bg-white" rows="3" placeholder="My current situation feels like..."></textarea>
                    </div>
                </div>
            </section>

            <section id="scripture-content" class="content-panel">
                 <div class="max-w-3xl mx-auto bg-white/50 p-8 rounded-lg shadow-sm border border-[#EAE0D5]">
                    <h2 class="text-3xl font-bold mb-4 text-[#6D5D4D]">Psalm 3 (ESV)</h2>
                    <p class="text-sm italic text-[#8A7968] mb-6">A Psalm of David, when he fled from Absalom his son.</p>
                    <div class="space-y-4 text-lg">
                        <p><span class="font-bold pr-2">¹</span><span id="verse-1">O LORD, how many are my foes! Many are rising against me;</span></p>
                        <p><span class="font-bold pr-2">²</span><span id="verse-2">many are saying of my soul, “There is no salvation for him in God.” Selah</span></p>
                        <p><span class="font-bold pr-2">³</span><span id="verse-3">But you, O LORD, are a shield about me, my glory, and the lifter of my head.</span></p>
                        <p><span class="font-bold pr-2">⁴</span><span id="verse-4">I cried aloud to the LORD, and he answered me from his holy hill. Selah</span></p>
                        <p><span class="font-bold pr-2">⁵</span><span id="verse-5">I lay down and slept; I awoke again, for the LORD sustained me.</span></p>
                        <p><span class="font-bold pr-2">⁶</span><span id="verse-6">I will not be afraid of many thousands of people who have set themselves against me all around.</span></p>
                        <p><span class="font-bold pr-2">⁷</span><span id="verse-7">Arise, O LORD! Save me, O my God! For you strike all my enemies on the cheek; you have broken the teeth of the wicked.</span></p>
                        <p><span class="font-bold pr-2">⁸</span><span id="verse-8">Salvation belongs to the LORD; your blessing be on your people! Selah</span></p>
                    </div>
                    <div class="mt-8 pt-8 border-t border-[#EAE0D5]">
                        <h3 class="text-2xl font-bold mb-4 text-[#6D5D4D]">Expository Notes</h3>
                        <ul class="space-y-4 text-lg leading-relaxed">
                            <li><strong class="font-semibold text-[#6D5D4D]">vv. 1-2 (The Lament):</strong> David begins by honestly assessing his dire situation. The attack is both physical ("many foes") and spiritual. The enemies' deepest thrust is theological: "There is no salvation for him in God." This is a crisis of faith, not just circumstance. The term "Selah" is likely a musical pause, inviting the reader to stop and feel the weight of this accusation.</li>
                            <li><strong class="font-semibold text-[#6D5D4D]">vv. 3-4 (The Turn):</strong> The word "But" in verse 3 is the pivot of the entire psalm. David consciously turns his focus from the overwhelming problem to the character of God. He declares three truths: God is a protective "shield," his "glory" (source of worth), and the "lifter of his head" (restorer of hope). This declaration is followed by action: he "cried aloud," and God answered.</li>
                            <li><strong class="font-semibold text-[#6D5D4D]">vv. 5-6 (The Fruit):</strong> The result of this trust is supernatural peace. The ability to "lay down and slept" amidst a rebellion is a profound demonstration of faith. God's sustaining presence provides an internal rest that fuels external courage. His fear of thousands is conquered by his faith in One.</li>
                             <li><strong class="font-semibold text-[#6D5D4D]">vv. 7-8 (The Confidence):</strong> David moves from defense to offense in prayer. He calls on God to "Arise" and save him. The graphic language of striking the cheek and breaking teeth is a poetic cry for God to silence his enemies' taunts and remove their power. The psalm concludes with a foundational declaration: victory and salvation are not in David's hands, but belong entirely to the LORD.</li>
                        </ul>
                    </div>
                </div>
            </section>

            <section id="core-concepts-content" class="content-panel">
                <div class="max-w-4xl mx-auto">
                    <div class="text-center mb-8">
                        <h2 class="text-3xl font-bold text-[#6D5D4D]">Exploring the Core Concepts</h2>
                        <p class="text-lg text-[#8A7968] mt-2">Click each tab to explore a part of the PPGR framework and reflect on how it applies to your life.</p>
                    </div>
                    <div class="flex justify-center space-x-2 sm:space-x-4 mb-8">
                        <button data-tab="principle" class="concept-tab px-4 py-2 sm:px-6 sm:py-3 font-semibold rounded-full transition-colors duration-300 bg-[#EAE0D5] hover:bg-[#D3A578] hover:text-white">Principle</button>
                        <button data-tab="problem" class="concept-tab px-4 py-2 sm:px-6 sm:py-3 font-semibold rounded-full transition-colors duration-300 bg-[#EAE0D5] hover:bg-[#D3A578] hover:text-white">Problem</button>
                        <button data-tab="gospel" class="concept-tab px-4 py-2 sm:px-6 sm:py-3 font-semibold rounded-full transition-colors duration-300 bg-[#EAE0D5] hover:bg-[#D3A578] hover:text-white">Gospel</button>
                        <button data-tab="response" class="concept-tab px-4 py-2 sm:px-6 sm:py-3 font-semibold rounded-full transition-colors duration-300 bg-[#EAE0D5] hover:bg-[#D3A578] hover:text-white">Response</button>
                    </div>
                    
                    <div class="bg-white/50 p-8 rounded-lg shadow-sm border border-[#EAE0D5]">
                        <div id="principle-panel" class="concept-panel">
                            <h3 class="text-2xl font-bold mb-4 text-[#6D5D4D]">Principle: God is Our Sustaining Shield.</h3>
                            <p class="text-lg leading-relaxed">The foundational truth that holds the universe together, and holds us together, is that <strong>God is our sustaining shield</strong>. David, with enemies on every side, declares this with defiant faith in verse 3: “But you, O LORD, are a shield about me, my glory, and the lifter of my head.” A shield protects from attack. "My glory" means God is the source of his worth and honor when the world heaps shame on him. "The lifter of my head" means God is the one who restores him from despair. This isn't just a nice idea; it is the reality of God's character for His people. He is our active protector, our source of value, and our restorer.</p>
                            <div class="mt-6 pt-6 border-t border-[#EAE0D5]">
                                <h4 class="text-xl font-semibold mb-2 text-[#6D5D4D]">Make it Personal</h4>
                                <p class="text-lg text-[#8A7968] mb-4">Where in your life today do you most need to remember that God is your shield and the lifter of your head?</p>
                                <textarea id="principle-input" class="personalization-input w-full p-3 border border-[#EAE0D5] rounded-md" rows="3" placeholder="I need God's protection in..."></textarea>
                            </div>
                        </div>
                        <div id="problem-panel" class="concept-panel" style="display:none;">
                            <h3 class="text-2xl font-bold mb-4 text-[#6D5D4D]">Problem: We Believe the Circumstances, Not the Shield.</h3>
                            <p class="text-lg leading-relaxed">The problem is that when the battle gets loud, <strong>we believe the circumstances, not the shield</strong>. David’s foes were not just numerous; they were vocal. Their most potent weapon wasn’t a sword but a word of unbelief: “There is no salvation for him in God” (v. 2). This is the ancient lie that echoes in our hearts today. The overwhelming evidence of our problems, our failures, and our fears screams that God is distant, powerless, or uncaring. We listen to the taunts of the enemy and our own anxious flesh, and we begin to doubt that the shield is really there for <em>us</em>. We functionally live as if we are orphans, left to fight our battles alone.</p>
                             <div class="mt-6 pt-6 border-t border-[#EAE0D5]">
                                <h4 class="text-xl font-semibold mb-2 text-[#6D5D4D]">Make it Personal</h4>
                                <p class="text-lg text-[#8A7968] mb-4">What specific circumstances or voices are making it hard for you to trust in God's presence and protection right now?</p>
                                <textarea id="problem-input" class="personalization-input w-full p-3 border border-[#EAE0D5] rounded-md" rows="3" placeholder="The voices of anxiety/fear are telling me..."></textarea>
                            </div>
                        </div>
                        <div id="gospel-panel" class="concept-panel" style="display:none;">
                            <h3 class="text-2xl font-bold mb-4 text-[#6D5D4D]">Gospel: Jesus is the Shield Who Was Struck for Us.</h3>
                            <p class="text-lg leading-relaxed">The good news is that <strong>Jesus is the shield who was struck for us</strong>. David cried out for a salvation that "belongs to the LORD" (v. 8), and Jesus is that salvation in the flesh. On the cross, Jesus was surrounded by his foes. He heard the ultimate taunt: "He trusts in God; let God deliver him now!" (Matthew 27:43). And in that moment, for our sake, the Father did not deliver him. Jesus, our divine shield, willingly absorbed the full blow of God’s wrath against our sin. He let himself be broken so we never would be. God did not lift Jesus' head from the shame of the cross; instead, He lifted his entire body from the finality of the grave. Because Jesus took our abandonment, we are given his eternal acceptance. He is the true King who has already "broken the teeth of the wicked"—sin, death, and Satan—and secured our ultimate victory.</p>
                             <div class="mt-6 pt-6 border-t border-[#EAE0D5]">
                                <h4 class="text-xl font-semibold mb-2 text-[#6D5D4D]">Make it Personal</h4>
                                <p class="text-lg text-[#8A7968] mb-4">How does the truth that Jesus was struck in your place change how you view your current struggles?</p>
                                <textarea id="gospel-input" class="personalization-input w-full p-3 border border-[#EAE0D5] rounded-md" rows="3" placeholder="Because of Jesus, I can face this by..."></textarea>
                            </div>
                        </div>
                        <div id="response-panel" class="concept-panel" style="display:none;">
                            <h3 class="text-2xl font-bold mb-4 text-[#6D5D4D]">Response: We Rest in the Shield, Not in Our Strength.</h3>
                            <p class="text-lg leading-relaxed mb-4">Therefore, because Jesus is our shield, <strong>we can rest in Him, not in our own strength</strong>. David’s response to God’s faithfulness was twofold: he cried out to God, and he went to sleep. "I cried aloud to the LORD, and he answered me... I lay down and slept; I awoke again, for the LORD sustained me" (vv. 4-5).</p>
                            <p class="text-lg leading-relaxed mb-2">This is our pattern for a grace-motivated life.</p>
                            <ul class="list-disc pl-5 space-y-2 text-lg">
                                <li><strong>We cry out.</strong> Instead of stoically pretending we have it all together, we can run to our Father with our fears and anxieties, confident that He hears us because of Jesus.</li>
                                <li><strong>We rest.</strong> True peace is not the absence of trouble but the presence of our Protector. We can find deep, spiritual rest—we can "sleep" in the middle of the storm—not because the threats have vanished, but because we know the One who sustains us never slumbers. Our security isn't in our ability to fight, but in the finished work of our King. Salvation belongs to the Lord.</li>
                            </ul>
                             <div class="mt-6 pt-6 border-t border-[#EAE0D5]">
                                <h4 class="text-xl font-semibold mb-2 text-[#6D5D4D]">Make it Personal</h4>
                                <p class="text-lg text-[#8A7968] mb-4">What would it look like for you to practically "cry out and rest" in this specific situation today?</p>
                                <textarea id="response-input" class="personalization-input w-full p-3 border border-[#EAE0D5] rounded-md" rows="3" placeholder="I can cry out by... and I can rest by..."></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="prayer-content" class="content-panel">
                <div class="max-w-3xl mx-auto bg-white/50 p-8 rounded-lg shadow-sm border border-[#EAE0D5]">
                    <h2 class="text-3xl font-bold mb-4 text-[#6D5D4D]">Your Personal Prayer</h2>
                     <div class="mt-4">
                        <h3 class="text-2xl font-bold mb-4 text-[#6D5D4D] flex items-center">
                            A Prayer from Your Reflections
                        </h3>
                        <p class="text-lg text-[#8A7968] mb-4">After reflecting in the sections above, click the button below. Gemini will compile your personal thoughts into a single, comprehensive prayer rooted in the hope of Psalm 3.</p>
                        <button id="compile-prayer-btn" class="w-full mb-4 px-6 py-3 font-semibold rounded-full transition-colors duration-300 bg-[#D3A578] text-white hover:bg-[#c59461]">
                            ✨ Compile My Prayer from My Reflections
                        </button>
                        <div id="compiled-prayer-output" class="p-4 bg-[#F3E9DE]/50 rounded-md border border-[#EAE0D5]" style="display: none;"></div>
                    </div>
                    <div class="mt-8 pt-8 border-t border-[#EAE0D5]">
                        <h3 class="text-2xl font-bold mb-4 text-[#6D5D4D]">For Further Study</h3>
                        <div class="space-y-4">
                            <div class="p-4 bg-white rounded-lg border border-[#EAE0D5]">
                                <h4 class="font-bold text-xl text-[#6D5D4D]">Psalm 27</h4>
                                <p class="text-lg text-[#8A7968]">Explore deeper themes of courage and trust in God as your "stronghold" in the face of fear.</p>
                            </div>
                            <div class="p-4 bg-white rounded-lg border border-[#EAE0D5]">
                                <h4 class="font-bold text-xl text-[#6D5D4D]">Isaiah 26:3-4</h4>
                                <p class="text-lg text-[#8A7968]">Meditate on the promise of "perfect peace" for those whose minds are stayed on the Lord.</p>
                            </div>
                            <div class="p-4 bg-white rounded-lg border border-[#EAE0D5]">
                                <h4 class="font-bold text-xl text-[#6D5D4D]">2 Corinthians 1:8-11</h4>
                                <p class="text-lg text-[#8A7968]">See how the Apostle Paul found that overwhelming hardship taught him to rely not on himself, but on God.</p>
                            </div>
                            <div class="p-4 bg-white rounded-lg border border-[#EAE0D5]">
                                <h4 class="font-bold text-xl text-[#6D5D4D]">Philippians 4:6-7</h4>
                                <p class="text-lg text-[#8A7968]">Learn about the call to replace anxiety with prayer, leading to a peace that "surpasses all understanding."</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <footer class="mt-12 py-4 border-t border-[#EAE0D5]">
            <p class="text-center text-sm text-[#8A7968]">&copy; 2025 McKay Caston. All Rights Reserved.</p>
        </footer>

    </div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const navLinks = document.querySelectorAll('.nav-link');
        const contentPanels = document.querySelectorAll('.content-panel');
        const conceptTabs = document.querySelectorAll('.concept-tab');
        const conceptPanels = document.querySelectorAll('.concept-panel');
        const personalizationInputs = document.querySelectorAll('.personalization-input');
        const compilePrayerBtn = document.getElementById('compile-prayer-btn');
        const compiledPrayerOutput = document.getElementById('compiled-prayer-output');

        const userReflections = {
            intro: '',
            principle: '',
            problem: '',
            gospel: '',
            response: ''
        };

        const verseMap = {
            principle: 3,
            problem: 2,
            gospel: 8,
            response: 5,
        };

        function updateNav(activeLink) {
            navLinks.forEach(link => link.classList.remove('active'));
            activeLink.classList.add('active');
        }

        function showContent(contentId) {
            contentPanels.forEach(panel => {
                panel.style.display = 'none';
                panel.classList.remove('active');
            });
            const activePanel = document.getElementById(contentId);
            if (activePanel) {
                activePanel.style.display = 'block';
                activePanel.classList.add('active');
            }
        }

        function removeVerseHighlights() {
            for (let i = 1; i <= 8; i++) {
                const verseSpan = document.getElementById(`verse-${i}`);
                if (verseSpan) verseSpan.classList.remove('highlight-verse');
            }
        }

        function highlightVerse(verseNumber) {
            removeVerseHighlights();
            const verseSpan = document.getElementById(`verse-${verseNumber}`);
            if (verseSpan) verseSpan.classList.add('highlight-verse');
        }

        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const sectionId = e.target.id.replace('nav-', '');
                updateNav(e.target);
                showContent(`${sectionId}-content`);
                
                if (sectionId === 'core-concepts') {
                    conceptTabs[0].click();
                } else {
                    removeVerseHighlights();
                }
            });
        });

        conceptTabs.forEach(tab => {
            tab.addEventListener('click', (e) => {
                const tabId = e.target.dataset.tab;
                conceptTabs.forEach(t => t.classList.remove('active'));
                e.target.classList.add('active');
                conceptPanels.forEach(panel => panel.style.display = 'none');
                document.getElementById(`${tabId}-panel`).style.display = 'block';

                if (verseMap[tabId]) {
                    highlightVerse(verseMap[tabId]);
                } else {
                     removeVerseHighlights();
                }
            });
        });

        personalizationInputs.forEach(input => {
            input.addEventListener('input', () => {
                const reflectionKey = input.id.split('-')[0];
                userReflections[reflectionKey] = input.value;
            });
        });
        
        compilePrayerBtn.addEventListener('click', async () => {
            const hasReflections = Object.values(userReflections).some(val => val.trim() !== '');

            if (!hasReflections) {
                compiledPrayerOutput.innerHTML = '<p class="text-red-600">Please share some of your reflections in the Home or Core Concepts sections before creating a prayer.</p>';
                compiledPrayerOutput.style.display = 'block';
                return;
            }

            compiledPrayerOutput.style.display = 'block';
            compiledPrayerOutput.innerHTML = '<p class="text-center text-[#8A7968]">✨ Weaving your thoughts into a prayer...</p>';
            compilePrayerBtn.disabled = true;
            compilePrayerBtn.classList.add('opacity-50', 'cursor-not-allowed');

            try {
                const systemPrompt = "You are a wise and empathetic pastoral guide. The user has provided their personal reflections on the different parts of Psalm 3. Synthesize their raw, personal notes into a beautiful, cohesive, first-person prayer. The prayer should follow the natural flow of Psalm 3: acknowledging the struggle, affirming God's character as a shield, remembering Christ's work, and committing to a response of faith and rest. Weave the user's specific thoughts and feelings seamlessly into this structure.";
                
                const userPrompt = `Here are my reflections:
- My current situation of feeling overwhelmed: "${userReflections.intro}"
- Where I need God as a shield (Principle): "${userReflections.principle}"
- The specific circumstances/voices I'm facing (Problem): "${userReflections.problem}"
- How Jesus's sacrifice impacts me (Gospel): "${userReflections.gospel}"
- How I want to respond in faith (Response): "${userReflections.response}"`;

                const generatedText = await callGemini(systemPrompt, userPrompt);
                compiledPrayerOutput.innerHTML = `<p class="text-lg leading-loose italic">${generatedText.replace(/\n/g, '<br>')}</p>`;
            } catch (error) {
                console.error('Error compiling prayer:', error);
                compiledPrayerOutput.innerHTML = '<p class="text-red-600">Sorry, something went wrong. Please try again later.</p>';
            } finally {
                compilePrayerBtn.disabled = false;
                compilePrayerBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        });

        async function callGemini(systemPrompt, userPrompt, retries = 3, delay = 1000) {
            const apiKey = ""; 
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

            const payload = {
                contents: [{ parts: [{ text: userPrompt }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };

            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    
                    const result = await response.json();
                    const candidate = result.candidates?.[0];

                    if (candidate && candidate.content?.parts?.[0]?.text) {
                        return candidate.content.parts[0].text;
                    } else {
                         throw new Error('Invalid response structure from Gemini API');
                    }
                } catch (error) {
                    if (i === retries - 1) throw error;
                    await new Promise(res => setTimeout(res, delay * Math.pow(2, i)));
                }
            }
             throw new Error('API call failed after multiple retries.');
        }

        document.getElementById('nav-home').classList.add('active');
        document.getElementById(`home-content`).classList.add('active');
        document.getElementById(`home-content`).style.display = 'block';
    });
</script>

</body>
</html>

